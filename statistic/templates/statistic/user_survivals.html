<!DOCTYPE html>

<html lang="zh">
<head>
	<meta charset="UTF-8">
	<title>活跃用户分析</title>
	<link rel="stylesheet" type="text/css" href="{{ static('statistic/css/statistic.css') }}"/>
	<script src="https://cdn.bootcss.com/jquery/2.1.4/jquery.js"></script>

	<script src="https://cdn.bootcss.com/bootstrap/3.3.6/js/bootstrap.js"></script>
	<link href="https://cdn.bootcss.com/bootstrap/3.3.6/css/bootstrap.css" rel="stylesheet">

    <script type="text/javascript">
        var url = "{{ url('get_lost') }}";
        var config_url = "{{ url('config') }}"
    </script>
    <script type="text/javascript" src="{{ static('statistic/js/lost.js') }}"></script>

</head>

<body>
<h1>用户流失分析</h1>

<section style="margin:10px 10px;">

		<form id="date_form" action="{{ url('survival') }}" method="post" style="display:flex;flex-direction:column;">
			<input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
			<label>时区: Asia/Shanghai</label>
			<div class="form-group">
				<label for="date_survival">
					首次活跃:
					<input type="date" value={{ date }} name="date" id="date_survival" }>
				</label>
				这天所在的
				<select name="interval_unit" id="interval_unit">
					<option value="1" {% if unit == "1" %} selected="selected" {%endif%}>天</option>
					<option value="2" {% if unit == "2" %} selected="selected" {%endif%}>周</option>
					<option value="3" {% if unit == "3" %} selected="selected" {%endif%}>月</option>
				</select>
			</div>

			<button type="submit" class="btn btn-default" >查看留存率</button>

		</form>

</section>

<table class="table" style="margin:10px 10px;">
	<thead>
	<tr>
		<th>IMEI ({{ survival_count.0 }}, 100%)</th>
		<th>1天后 ({{ survival_count.1 }}, {{ survival_count.1/survival_count.0 * 100 }}%)</th>
		<th>1周后 ({{ survival_count.2 }}, {{ survival_count.2/survival_count.0 * 100 }}%)</th>
		<th>1月后 ({{ survival_count.3 }}, {{ survival_count.3/survival_count.0 *100 }}%)</th>
		<th>1年后 ({{ survival_count.4 }}, {{ survival_count.4/survival_count.0 * 100 }}%)</th>
		<th>最近一周 ({{ survival_count.5 }}, {{ survival_count.5/survival_count.0 *100 }}%)</th>
	</tr>
	</thead>
	{% for user_survival in survivals %}
	<tr>
		<td >{{ user_survival.imei }}</td>
		<td {%if user_survival.survival_day() %} class="success" {%endif%}>{{ user_survival.survival_day() }}</td>
		<td {%if user_survival.survival_week() %} class="success" {%endif%}>{{ user_survival.survival_week() }}</td>
		<td {%if user_survival.survival_month() %} class="success" {%endif%}>{{ user_survival.survival_month() }}</td>
		<td {%if user_survival.survival_year() %} class="success" {%endif%} >{{ user_survival.survival_year() }}</td>
		<td {%if user_survival.survival_last_week() %} class="success" {%endif%}>{{ user_survival.survival_last_week() }}</td>
	</tr>
	{% endfor %}
</table>

<section style="margin:10px 10px;">
    <button class="btn btn-default" style="margin-top:1em;" onclick="get_next_day_lost()">查看次日流失用户的邮箱配置情况</button>

    <div id="lost_next_day">
        <header id="header">

        </header>

        <div id="content">

        </div>

        <div id="config">

        </div>

    </div>
</section>
    
</body>

</html>